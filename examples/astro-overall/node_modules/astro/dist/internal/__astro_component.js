var __defProp = Object.defineProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, {get: all[name], enumerable: true});
};

// src/internal/__astro_component.ts
import hash from "shorthash";
import {valueToEstree} from "estree-util-value-to-estree";
import {generate} from "astring";

// src/internal/renderer-astro.ts
var renderer_astro_exports = {};
__export(renderer_astro_exports, {
  check: () => check,
  renderToStaticMarkup: () => renderToStaticMarkup
});
function check(Component) {
  return Component.isAstroComponent;
}
async function renderToStaticMarkup(Component, props, children) {
  const html = await Component.__render(props, children);
  return {html};
}

// src/internal/renderer-html.ts
var renderer_html_exports = {};
__export(renderer_html_exports, {
  renderToStaticMarkup: () => renderToStaticMarkup2
});

// src/internal/h.ts
var voidTags = new Set(["area", "base", "br", "col", "command", "embed", "hr", "img", "input", "keygen", "link", "meta", "param", "source", "track", "wbr"]);
function* _h(tag, attrs, children) {
  if (tag.toLowerCase() === "!doctype") {
    yield `<${tag} `;
    if (attrs) {
      yield Object.keys(attrs).join(" ");
    }
    yield ">";
    return;
  }
  yield `<${tag}`;
  if (attrs) {
    for (let [key, value] of Object.entries(attrs)) {
      if (value === "")
        yield ` ${key}=""`;
      else if (value == null || value === false)
        yield "";
      else if (value === true)
        yield ` ${key}`;
      else
        yield ` ${key}="${value}"`;
    }
  }
  yield ">";
  if (voidTags.has(tag)) {
    return;
  }
  for (let child of children) {
    if (typeof child === "function") {
      yield child();
    } else if (typeof child === "string") {
      yield child;
    } else if (!child && child !== 0) {
    } else {
      yield child;
    }
  }
  yield `</${tag}>`;
}
async function h(tag, attrs, ...pChildren) {
  const children = await Promise.all(pChildren.flat(Infinity));
  if (typeof tag === "function") {
    return tag(attrs, ...children);
  }
  return Array.from(_h(tag, attrs, children)).join("");
}

// src/internal/renderer-html.ts
async function renderToStaticMarkup2(tag, props, children) {
  const html = await h(tag, props, Promise.resolve(children));
  return {
    html
  };
}

// src/internal/__astro_component.ts
var serialize = (value) => generate(valueToEstree(value));
var astroRendererInstance = {
  source: "",
  renderer: renderer_astro_exports,
  polyfills: [],
  hydrationPolyfills: []
};
var astroHtmlRendererInstance = {
  source: "",
  renderer: renderer_html_exports,
  polyfills: [],
  hydrationPolyfills: []
};
var rendererInstances = [];
function setRenderers(_rendererInstances) {
  rendererInstances = [astroRendererInstance].concat(_rendererInstances);
}
function isCustomElementTag(name) {
  return typeof name === "string" && /-/.test(name);
}
var rendererCache = new Map();
async function resolveRenderer(Component, props = {}, children) {
  if (rendererCache.has(Component)) {
    return rendererCache.get(Component);
  }
  const errors = [];
  for (const instance of rendererInstances) {
    const {renderer} = instance;
    try {
      const shouldUse = await renderer.check(Component, props, children);
      if (shouldUse) {
        rendererCache.set(Component, instance);
        return instance;
      }
    } catch (err) {
      errors.push(err);
    }
  }
  if (errors.length) {
    throw errors[0];
  }
}
async function generateHydrateScript({instance, astroId, props}, {hydrate, componentUrl, componentExport}) {
  const {source} = instance;
  let hydrationSource = "";
  if (instance.hydrationPolyfills.length) {
    hydrationSource += `await Promise.all([${instance.hydrationPolyfills.map((src) => `import("${src}")`).join(", ")}]);
`;
  }
  hydrationSource += source ? `
  const [{ ${componentExport.value}: Component }, { default: hydrate }] = await Promise.all([import("${componentUrl}"), import("${source}")]);
  return (el, children) => hydrate(el)(Component, ${serialize(props)}, children);
` : `
  await import("${componentUrl}");
  return () => {};
`;
  const hydrationScript = `<script type="module">
import setup from '/_astro_frontend/hydrate/${hydrate}.js';
setup("${astroId}", async () => {
  ${hydrationSource}
});
</script>`;
  return hydrationScript;
}
var getComponentName = (Component, componentProps) => {
  var _a;
  if (componentProps.displayName)
    return componentProps.displayName;
  switch (typeof Component) {
    case "function":
      return (_a = Component.displayName) != null ? _a : Component.name;
    case "string":
      return Component;
    default: {
      return Component;
    }
  }
};
var __astro_component = (Component, metadata = {}) => {
  if (Component == null) {
    throw new Error(`Unable to render ${metadata.displayName} because it is ${Component}!
Did you forget to import the component or is it possible there is a typo?`);
  } else if (typeof Component === "string" && !isCustomElementTag(Component)) {
    throw new Error(`Astro is unable to render ${metadata.displayName}!
Is there a renderer to handle this type of component defined in your Astro config?`);
  }
  return async (props, ..._children) => {
    const children = _children.join("\n");
    let instance = await resolveRenderer(Component, props, children);
    if (!instance) {
      if (isCustomElementTag(Component)) {
        instance = astroHtmlRendererInstance;
      } else {
        instance = rendererInstances.length === 2 ? rendererInstances[1] : void 0;
      }
      if (!instance) {
        const name = getComponentName(Component, metadata);
        throw new Error(`No renderer found for ${name}! Did you forget to add a renderer to your Astro config?`);
      }
    }
    let {html} = await instance.renderer.renderToStaticMarkup(Component, props, children, metadata);
    if (instance.polyfills.length) {
      let polyfillScripts = instance.polyfills.map((src) => `<script type="module" src="${src}"></script>`).join("");
      html = html + polyfillScripts;
    }
    if (!metadata.hydrate) {
      return html.replace(/\<\/?astro-fragment\>/g, "");
    }
    const astroId = hash.unique(html);
    const script = await generateHydrateScript({instance, astroId, props}, metadata);
    const astroRoot = `<astro-root uid="${astroId}">${html}</astro-root>`;
    return [astroRoot, script].join("\n");
  };
};
export {
  __astro_component,
  setRenderers
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL2ludGVybmFsL19fYXN0cm9fY29tcG9uZW50LnRzIiwgIi4uLy4uL3NyYy9pbnRlcm5hbC9yZW5kZXJlci1hc3Ryby50cyIsICIuLi8uLi9zcmMvaW50ZXJuYWwvcmVuZGVyZXItaHRtbC50cyIsICIuLi8uLi9zcmMvaW50ZXJuYWwvaC50cyJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7OztBQ0hBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBTyxlQUFlLFdBQWdCO0FBQ3BDLFNBQU8sVUFBVTtBQUFBO0FBR25CLG9DQUEyQyxXQUFnQixPQUFZLFVBQWtCO0FBQ3ZGLFFBQU0sT0FBTyxNQUFNLFVBQVUsU0FBUyxPQUFPO0FBQzdDLFNBQU8sQ0FBRTtBQUFBOzs7QUNOWDtBQUFBO0FBQUE7QUFBQTs7O0FDS0EsSUFBTSxXQUFXLElBQUksSUFBSSxDQUFDLFFBQVEsUUFBUSxNQUFNLE9BQU8sV0FBVyxTQUFTLE1BQU0sT0FBTyxTQUFTLFVBQVUsUUFBUSxRQUFRLFNBQVMsVUFBVSxTQUFTO0FBR3ZKLGFBQWEsS0FBYSxPQUFlLFVBQXlCO0FBQ2hFLE1BQUksSUFBSSxrQkFBa0IsWUFBWTtBQUNwQyxVQUFNLElBQUk7QUFDVixRQUFJLE9BQU87QUFDVCxZQUFNLE9BQU8sS0FBSyxPQUFPLEtBQUs7QUFBQTtBQUVoQyxVQUFNO0FBQ047QUFBQTtBQUdGLFFBQU0sSUFBSTtBQUNWLE1BQUksT0FBTztBQUNULGFBQVMsQ0FBQyxLQUFLLFVBQVUsT0FBTyxRQUFRLFFBQVE7QUFDOUMsVUFBSSxVQUFVO0FBQUksY0FBTSxJQUFJO0FBQUEsZUFDbkIsU0FBUyxRQUFRLFVBQVU7QUFBTyxjQUFNO0FBQUEsZUFDeEMsVUFBVTtBQUFNLGNBQU0sSUFBSTtBQUFBO0FBQzlCLGNBQU0sSUFBSSxRQUFRO0FBQUE7QUFBQTtBQUczQixRQUFNO0FBR04sTUFBSSxTQUFTLElBQUksTUFBTTtBQUNyQjtBQUFBO0FBR0YsV0FBUyxTQUFTLFVBQVU7QUFJMUIsUUFBSSxPQUFPLFVBQVUsWUFBWTtBQUMvQixZQUFNO0FBQUEsZUFDRyxPQUFPLFVBQVUsVUFBVTtBQUNwQyxZQUFNO0FBQUEsZUFDRyxDQUFDLFNBQVMsVUFBVSxHQUFHO0FBQUEsV0FFM0I7QUFDTCxZQUFNO0FBQUE7QUFBQTtBQUlWLFFBQU0sS0FBSztBQUFBO0FBSWIsaUJBQXdCLEtBQVcsVUFBa0IsV0FBbUM7QUFDdEYsUUFBTSxXQUFXLE1BQU0sUUFBUSxJQUFJLFVBQVUsS0FBSztBQUNsRCxNQUFJLE9BQU8sUUFBUSxZQUFZO0FBRTdCLFdBQU8sSUFBSSxPQUFPLEdBQUc7QUFBQTtBQUd2QixTQUFPLE1BQU0sS0FBSyxHQUFHLEtBQUssT0FBTyxXQUFXLEtBQUs7QUFBQTs7O0FEMURuRCxxQ0FBb0MsS0FBYSxPQUE0QixVQUFrQjtBQUM3RixRQUFNLE9BQU8sTUFBTSxFQUFFLEtBQUssT0FBTyxRQUFRLFFBQVE7QUFDakQsU0FBTztBQUFBLElBQ0w7QUFBQTtBQUFBOzs7QUZJSixJQUFNLFlBQVksQ0FBQyxVQUFpQixTQUFTLGNBQWM7QUFTM0QsSUFBTSx3QkFBMEM7QUFBQSxFQUM5QyxRQUFRO0FBQUEsRUFDUixVQUFVO0FBQUEsRUFDVixXQUFXO0FBQUEsRUFDWCxvQkFBb0I7QUFBQTtBQUd0QixJQUFNLDRCQUE4QztBQUFBLEVBQ2xELFFBQVE7QUFBQSxFQUNSLFVBQVU7QUFBQSxFQUNWLFdBQVc7QUFBQSxFQUNYLG9CQUFvQjtBQUFBO0FBR3RCLElBQUksb0JBQXdDO0FBRXJDLHNCQUFzQixvQkFBd0M7QUFDbkUsc0JBQW9CLENBQUMsdUJBQXVCLE9BQU87QUFBQTtBQUdyRCw0QkFBNEIsTUFBeUI7QUFDbkQsU0FBTyxPQUFPLFNBQVMsWUFBWSxJQUFJLEtBQUs7QUFBQTtBQUc5QyxJQUFNLGdCQUFnQixJQUFJO0FBRzFCLCtCQUErQixXQUFnQixRQUFhLElBQUksVUFBMEQ7QUFDeEgsTUFBSSxjQUFjLElBQUksWUFBWTtBQUNoQyxXQUFPLGNBQWMsSUFBSTtBQUFBO0FBRzNCLFFBQU0sU0FBa0I7QUFDeEIsYUFBVyxZQUFZLG1CQUFtQjtBQUN4QyxVQUFNLENBQUUsWUFBYTtBQUtyQixRQUFJO0FBQ0YsWUFBTSxZQUFxQixNQUFNLFNBQVMsTUFBTSxXQUFXLE9BQU87QUFFbEUsVUFBSSxXQUFXO0FBQ2Isc0JBQWMsSUFBSSxXQUFXO0FBQzdCLGVBQU87QUFBQTtBQUFBLGFBRUYsS0FBUDtBQUNBLGFBQU8sS0FBSztBQUFBO0FBQUE7QUFJaEIsTUFBSSxPQUFPLFFBQVE7QUFFakIsVUFBTSxPQUFPO0FBQUE7QUFBQTtBQVdqQixxQ0FBcUMsQ0FBRSxVQUFVLFNBQVMsUUFBK0IsQ0FBRSxTQUFTLGNBQWMsa0JBQXFEO0FBQ3JLLFFBQU0sQ0FBRSxVQUFXO0FBRW5CLE1BQUksa0JBQWtCO0FBQ3RCLE1BQUksU0FBUyxtQkFBbUIsUUFBUTtBQUN0Qyx1QkFBbUIsc0JBQXNCLFNBQVMsbUJBQW1CLElBQUksQ0FBQyxRQUFRLFdBQVcsU0FBUyxLQUFLO0FBQUE7QUFBQTtBQUc3RyxxQkFBbUIsU0FDZjtBQUFBLGFBQ08sZ0JBQWdCLDBFQUEwRSwyQkFBMkI7QUFBQSxvREFDOUUsVUFBVTtBQUFBLElBRXhEO0FBQUEsa0JBQ1k7QUFBQTtBQUFBO0FBSWhCLFFBQU0sa0JBQWtCO0FBQUEsOENBQ29CO0FBQUEsU0FDckM7QUFBQSxJQUNMO0FBQUE7QUFBQTtBQUlGLFNBQU87QUFBQTtBQUdULElBQU0sbUJBQW1CLENBQUMsV0FBZ0IsbUJBQXdCO0FBOUdsRTtBQStHRSxNQUFJLGVBQWU7QUFBYSxXQUFPLGVBQWU7QUFDdEQsVUFBUSxPQUFPO0FBQUEsU0FDUjtBQUNILGFBQU8sZ0JBQVUsZ0JBQVYsWUFBeUIsVUFBVTtBQUFBLFNBQ3ZDO0FBQ0gsYUFBTztBQUFBLGFBQ0E7QUFDUCxhQUFPO0FBQUE7QUFBQTtBQUFBO0FBS04sSUFBTSxvQkFBb0IsQ0FBQyxXQUFnQixXQUFtQyxPQUFjO0FBQ2pHLE1BQUksYUFBYSxNQUFNO0FBQ3JCLFVBQU0sSUFBSSxNQUFNLG9CQUFvQixTQUFTLDZCQUE2QjtBQUFBO0FBQUEsYUFDakUsT0FBTyxjQUFjLFlBQVksQ0FBQyxtQkFBbUIsWUFBWTtBQUMxRSxVQUFNLElBQUksTUFBTSw2QkFBNkIsU0FBUztBQUFBO0FBQUE7QUFHeEQsU0FBTyxPQUFPLFVBQWUsY0FBd0I7QUFDbkQsVUFBTSxXQUFXLFVBQVUsS0FBSztBQUNoQyxRQUFJLFdBQVcsTUFBTSxnQkFBZ0IsV0FBVyxPQUFPO0FBRXZELFFBQUksQ0FBQyxVQUFVO0FBQ2IsVUFBSSxtQkFBbUIsWUFBWTtBQUNqQyxtQkFBVztBQUFBLGFBQ047QUFHTCxtQkFBVyxrQkFBa0IsV0FBVyxJQUFJLGtCQUFrQixLQUFLO0FBQUE7QUFHckUsVUFBSSxDQUFDLFVBQVU7QUFDYixjQUFNLE9BQU8saUJBQWlCLFdBQVc7QUFDekMsY0FBTSxJQUFJLE1BQU0seUJBQXlCO0FBQUE7QUFBQTtBQUc3QyxRQUFJLENBQUUsUUFBUyxNQUFNLFNBQVMsU0FBUyxxQkFBcUIsV0FBVyxPQUFPLFVBQVU7QUFFeEYsUUFBSSxTQUFTLFVBQVUsUUFBUTtBQUM3QixVQUFJLGtCQUFrQixTQUFTLFVBQVUsSUFBSSxDQUFDLFFBQVEsOEJBQThCLGtCQUFrQixLQUFLO0FBQzNHLGFBQU8sT0FBTztBQUFBO0FBSWhCLFFBQUksQ0FBQyxTQUFTLFNBQVM7QUFFckIsYUFBTyxLQUFLLFFBQVEsMEJBQTBCO0FBQUE7QUFJaEQsVUFBTSxVQUFVLEtBQUssT0FBTztBQUM1QixVQUFNLFNBQVMsTUFBTSxzQkFBc0IsQ0FBRSxVQUFVLFNBQVMsUUFBUztBQUN6RSxVQUFNLFlBQVksb0JBQW9CLFlBQVk7QUFDbEQsV0FBTyxDQUFDLFdBQVcsUUFBUSxLQUFLO0FBQUE7QUFBQTsiLAogICJuYW1lcyI6IFtdCn0K
